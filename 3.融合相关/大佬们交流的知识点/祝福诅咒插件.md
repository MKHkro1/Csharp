

![image.png](https://picgo18719498306.oss-cn-guangzhou.aliyuncs.com/20251005183850890.png)
```C
[HarmonyPatch(typeof(Plant))]0个引用public class PlantPatch{[HarmonyPatch (nameof (Plant.TakeDamage))][HarmonyPrefix]0个引用public static bool Prefix(Plant instance,ref int damage)finstance.cursedZombie !null)instance.cursedZombie.theHealth -damage:instance.cursedZombie.UpdateHealthText (returnfalse:returntrue;
```
使用了 Harmony 库进行补丁（Patch）操作。
Harmony 是一个用于修改（修补）C# 方法的库，常用于游戏模组开发。

这段代码的目标是修改游戏中的 `Plant` 类的 `TakeDamage` 方法。
具体来说，它使用了一个 `HarmonyPrefix` 补丁，
这意味着它会在原始的 `TakeDamage` 方法执行之前执行。

1. `[HarmonyPatch(typeof(Plant))]`：这表示这个补丁类是针对 `Plant` 类型的。
2. `public class PlantPatch`：定义了一个名为 `PlantPatch` 的补丁类。
3. `[HarmonyPatch(nameof(Plant.TakeDamage))]`：指定要补丁的方法为 `Plant` 类的 `TakeDamage` 方法。
4. `[HarmonyPrefix]`：表示这是一个前缀补丁，即在原始方法执行前执行。
5. `public static bool Prefix(Plant __instance, ref int damage)`：这是补丁方法。它必须是静态的，返回值为 bool 类型，并遵循 Harmony 的前缀补丁约定。
    - `__instance`：Harmony 使用双下划线前缀来表示实例参数，这里代表调用该方法的 `Plant` 实例。
    - `ref int damage`：表示传递给 `TakeDamage` 方法的 `damage` 参数，通过引用传递，因此可以修改。
6. 在方法体内：
    - 首先检查 `__instance`（即当前植物）的 `cursedZombie` 字段是否不为空（`null`）。
    - 如果不为空，则执行以下操作：
        - 将传入的 `damage` 值从 `cursedZombie` 的血量（`theHealth`）中减去。
        - 调用 `cursedZombie` 的 `UpdateHealthText` 方法更新血条显示。
        - 返回 `false`，表示不执行原始的 `TakeDamage` 方法（即阻止原始方法执行）。
    - 如果 `cursedZombie` 为空，则返回 `true`，表示继续执行原始的 `TakeDamage` 方法。

总结：当植物受到伤害时，如果该植物关联了一个被诅咒的僵尸（`cursedZombie`），则伤害会转移到这个僵尸上，并且不再执行植物原本的受伤逻辑（即植物本身不会掉血，而是僵尸掉血）。如果植物没有关联被诅咒的僵尸，则正常执行植物的受伤逻辑。

> [!ys]
> 其实，Zombie有个EatAffect
> 仙人南瓜这类反伤都是这个

> [!Kb]
> （但是我想要的不是反伤啊，是放诅咒的僵尸抗伤）

